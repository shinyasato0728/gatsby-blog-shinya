---
path: /marketing/spa_abtesting
date: 2020-07-28T19:00:00
thumbnail: /images/blog/2020.07.28_01-top.jpg
title: ã€ä»®è¨­æ¤œè¨¼ã€‘SPAï¼ˆGatsbyï¼‰ã‚’ä½¿ã„ã€Google Optimizeã¦ã‚™A/Bãƒ†ã‚¹ãƒˆã‚’ã™ã‚‹æ–¹æ³•
tags:
  - ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°
  - ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°
description: >-
  Google Optimizeã¯ã€Googleå…¬å¼ã‹ã‚‰ãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¦ã„ã‚‹A/Bãƒ†ã‚¹ãƒˆã‚’è¡Œã†ã“ã¨ãŒã§ãã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚Google Analyticsã¨é€£å‹•ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’è“„ç©ã—ã¤ã¤ã€A/Bãƒ†ã‚¹ãƒˆã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚ä¾¿åˆ©ãªãƒ„ãƒ¼ãƒ«ã§ã™ãŒã€SPAã§ä½¿ã†å ´åˆã¯éåŒæœŸé€šä¿¡ã®ç‰¹æ€§ä¸Šã€ã¾ãšç’°å¢ƒã‚’æ§‹ç¯‰ã—ç‰¹æ®Šãªæ–¹æ³•ã§ãƒ†ã‚¹ãƒˆã‚’è¡Œã†å¿…è¦ãŒã”ã–ã„ã¾ã™ã€‚
---

ã“ã‚“ã«ã¡ã¯ã€ã‚·ãƒ³ãƒ¤ã§ã™ï¼

ä»Šå›ã¯ã€*ã€ä»®è¨­æ¤œè¨¼ã€‘SPAï¼ˆGatsbyï¼‰ã‚’ä½¿ã„ã€Google Optimizeã¦ã‚™A/Bãƒ†ã‚¹ãƒˆã‚’ã™ã‚‹æ–¹æ³•*ã¨ã„ã†ãƒ†ãƒ¼ãƒã§ã€ãŠè©±ã—ã„ãŸã—ã¾ã™ã€‚

---

## æ¦‚è¦

SPAã¯éåŒæœŸé€šä¿¡ã®ç‰¹æ€§ä¸Šã€*[Google Optimize](https://marketingplatform.google.com/intl/ja/about/optimize/)ã§A/Bãƒ†ã‚¹ãƒˆã‚’ã™ã‚‹ã«ã¯ã€ç‰¹æ®Šãªã‚„ã‚Šæ–¹ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚*

ã‚„ã‚Šæ–¹ã•ãˆã‚ã‹ã‚Œã°ç°¡å˜ãªã®ã§ã™ãŒã€æ—¥æœ¬èªã§ã¾ã¨ã‚ã‚‰ã‚ŒãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒãªã‹ã£ãŸã®ã§ã€è‡ªåˆ†ã§ä½œã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚  
GTMï¼ˆGoogle Tag Managerï¼‰ã‚’ä½¿ã£ã¦Optimizeã‚’é…ä¿¡ã™ã‚‹ã‚„ã‚Šæ–¹ã¯ã€**[Googleå…¬å¼ã‹ã‚‰éæ¨å¥¨ã¨ãªã£ã¦ã„ã‚‹ã®ã§](https://support.google.com/optimize/answer/6314801?hl=ja)**ã€ç›´æ¥ã‚³ãƒ¼ãƒ‰ã‚’åŸ‹ã‚è¾¼ã¿ã¾ã™ã€‚

---

## ç’°å¢ƒæ§‹ç¯‰ã‚’ã™ã‚‹

ä»¥ä¸‹ã®æ–¹æ³•ã§ã€ã”ä½¿ç”¨ä¸­ã®Macã«ç’°å¢ƒã‚’æ§‹ç¯‰ã—ã¦ã„ãã¾ã™ã€‚  
æ—¢ã«ç’°å¢ƒæ§‹ç¯‰æ¸ˆã¿ã®æ–¹ã¯ã€ã“ã¡ã‚‰ã®é …ç›®ã¯é£›ã°ã—ã¦èª­ã‚“ã§ãã ã•ã„ã€‚  
å°‘ã—é›£ã—ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€é ‘å¼µã£ã¦ã¤ã„ã¦ãã¦ãã ã•ã„ğŸ˜…

### ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’èµ·å‹•ã™ã‚‹

ã¾ãšã¯ã€ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã®èµ·å‹•ã‚’è¡Œã„ã¾ã™ã€‚  
Macä¸‹éƒ¨ã®ã€ŒLaunchpadã€ã§ã€ã€Œterminalã€ã¨å…¥åŠ›ã—ã¦å‡ºã¦ããŸã‚¢ã‚¤ã‚³ãƒ³ã‚’ã€ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚

![](/images/blog/2020.07.01_03-01.jpg)

### Homebrewã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¦ã€Homebrewã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```shell
$ /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
```

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¦ã€Homebrewã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒè¡¨ç¤ºã•ã‚ŒãŸã‚‰ã€æˆåŠŸã—ã¦ã„ã¾ã™ğŸ˜Š

```shell
$ brew -v
#> Homebrew 1.2.3
#> Homebrew/homebrew-core (git revision 7212; last commit 2017-07-02)
```

### Nodebrewã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¦ã€Nodebrewã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```shell
$ brew install nodebrew
```

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¦ã€Nodebrewã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒè¡¨ç¤ºã•ã‚ŒãŸã‚‰ã€æˆåŠŸã—ã¦ã„ã¾ã™ğŸ˜Š

```shell
$ nodebrew -v
#> nodebrew 1.0.0
```

### Nodebrewã‚’ä½¿ãˆã‚‹æ§˜ã«ã™ã‚‹

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ä¸Šã§å…¥åŠ›ã—ã¦ã€ç’°å¢ƒå¤‰æ•°ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```shell
$ vi ~/.bash_profile
```

ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã®ç”»é¢ãŒå¤‰ã‚ã£ãŸã‚‰ã€

1. ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®ã€ŒIã€ã‚’æŠ¼ã™
2. ã€Œexport PATH=$HOME/.nodebrew/current/bin:$PATHã€ã®ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã™ã‚‹ã€‚

ä»¥ä¸‹ã®æ§˜ãªç”»åƒã«ãªã£ã¦ã„ã‚Œã°OKã§ã™ã€‚

![](/images/blog/2020.07.12_06-01.jpg)

ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ãŸã‚‰ã€

1. ã€Œescã€ã‚­ãƒ¼ã‚’æŠ¼ã™
2. ã€Œ:wqã€ã¨å…¥åŠ›ã™ã‚‹
3. ã€ŒEnterã€ã‚’æŠ¼ã™

ä»¥ä¸Šã§ã€ã‚³ãƒ¼ãƒ‰ã®ä¿å­˜ãŒçµ‚ã‚ã‚Šã€ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ãŒé–‰ã˜ã¾ã™ğŸ˜Š

### Nodebrewã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¦ã€å…ˆã»ã©ä½œã£ãŸ`bash_profile`ã‚’åæ˜ ã•ã›ã¾ã™ã€‚

```shell
$ source ~/.bash_profile
```

æ¬¡ã«ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¦ã€Nodebrewã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ã¾ã™ã€‚

```shell
$ nodebrew setup
```

### Node.jsã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¦ã€Node.jsã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```shell
$ nodebrew install-binary v12.13.1
```

æ¬¡ã«ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¦ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸNode.jsã‚’ä½¿ãˆã‚‹æ§˜ã«ã—ã¾ã™ã€‚

```shell
$ nodebrew use v12.13.1
```

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¦ã€Node.jsã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒè¡¨ç¤ºã•ã‚ŒãŸã‚‰ã€æˆåŠŸã—ã¦ã„ã¾ã™ğŸ˜Š

```shell
$ node -v
#> v12.13.1
```

### Gatsby.jsã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¦ã€Gatsby.jsã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```shell
$ npm install -g gatsby-cli
```

---

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã™ã‚‹

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¦ã€Gatsby.jsã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

```shell
$ gatsby new gatsby-project
```

`gatsby-project`ã®éƒ¨åˆ†ã¯ã€å¥½ããªåå‰ã«å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚

### ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼ã‚’ç«‹ã¡ä¸Šã’ã‚‹

ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‹ã‚‰ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¦ã€ä½œæˆã—ãŸãƒ•ã‚©ãƒ«ãƒ€ã«ç§»å‹•ã—ã¾ã™ã€‚

```shell
$ cd gatsby-project
```

ç§»å‹•å¾Œã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚  
å…¥åŠ›å¾Œ`http://localhost:8000`ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã€ä¸‹è¨˜ã®ç”»é¢ãŒè¡¨ç¤ºã•ã‚ŒãŸã‚‰ã€æ­£å¸¸ã«ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼ãŒç«‹ã¡ä¸ŠãŒã£ã¦ã„ã¾ã™ğŸ˜Š

```shell
$ npm run dev
```

![](/images/blog/2020.07.20_01-01.jpg)

---

## Google Optimizeã®æº–å‚™ã‚’ã™ã‚‹

[ã‚ªãƒ—ãƒ†ã‚£ãƒã‚¤ã‚ºã‚¹ãƒ‹ãƒšãƒƒãƒˆ](https://support.google.com/optimize/answer/6262084?hl=ja#get-optimize)ã¨ã€~~[ã‚¢ãƒ³ãƒãƒ•ãƒªãƒƒã‚«ãƒ¼ã‚¹ãƒ‹ãƒšãƒƒãƒˆ](https://support.google.com/optimize/answer/7100284?hl=ja)~~ã‚’ã€```gatsby-ssr.js```ã«è¨˜è¼‰ã—ã¦ã€Google Optimizeã‚’ä½¿ã†æº–å‚™ã‚’ã—ã¾ã™ã€‚  
Gatsbyãªã‚‰ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒã‚ã‚Šã¾ã™ãŒã€Optimizeã‹ã‚‰è­¦å‘ŠãŒå‡ºãŸã®ã§ã€ç›´æ¥ã‚³ãƒ¼ãƒ‰ã‚’åŸ‹ã‚è¾¼ã¿ã¾ã™ã€‚

```javascript
import React from 'react';

export const onRenderBody = ({ setHeadComponents }) => {
 if (process.env.NODE_ENV === `production`) {
   setHeadComponents([
     // ã‚ªãƒ—ãƒ†ã‚£ãƒã‚¤ã‚ºã‚¹ãƒ‹ãƒšãƒƒãƒˆ
     <script async src="https://www.googletagmanager.com/gtag/js?id=UA-........."></script>,
     <script
       dangerouslySetInnerHTML={{
         __html: `
         window.dataLayer = window.dataLayer || [];
         function gtag(){dataLayer.push(arguments);}
         gtag('js', new Date());
         gtag('config', 'UA-.........', { 'optimize_id': 'GTM-.........'});
         `
       }}
     />
   ])
 }
}
```

### è¿½è¨˜

å¾Œè¿°ã®ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ™ãƒ³ãƒˆã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã™ã‚‹å ´åˆã€ã‚¢ãƒ³ãƒãƒ•ãƒªãƒƒã‚«ãƒ¼ã‚¹ãƒ‹ãƒšãƒƒãƒˆã¯å¿…è¦ãªã„ã¿ãŸã„ã§ã™ã€‚  
Optimizeã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«è¨ºæ–­ã‚’ã™ã‚‹ã¨ã€ã‚¢ãƒ³ãƒãƒ•ãƒªãƒƒã‚«ãƒ¼ã‚¹ãƒ‹ãƒšãƒƒãƒˆã‚’åŸ‹ã‚è¾¼ã‚€æ§˜æ¨å¥¨ã•ã‚Œã¾ã™ãŒã€ç‰¹ã«å•é¡Œã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

![](/images/blog/2020.07.28_01-01.jpg)

---

## ãƒ†ã‚¹ãƒˆã®æœ‰åŠ¹åŒ–ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’å¤‰æ›´ã™ã‚‹

SPAã®å ´åˆã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®è¨­å®šã§ã‚ã‚‹ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®ã¾ã¾ãƒ†ã‚¹ãƒˆã‚’è¡Œã†ã¨ã€*ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ä¸€ç¬ãƒ†ã‚¹ãƒˆçµæœãŒåæ˜ ã•ã‚Œã€ãã®å¾ŒJSã§ãƒ†ã‚¹ãƒˆçµæœãŒä¸Šæ›¸ãã•ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚*  
ãã†ãªã‚‹ã¨Optimizeä¸Šã§ã¯50/50ã§ã™ãŒã€**å®Ÿéš›ã¯ã‚ªãƒªã‚¸ãƒŠãƒ«ã®ãƒ‡ã‚¶ã‚¤ãƒ³ã®æç”»ãŒå¢—ãˆã¾ã™ã€‚**  
*ä¸Šæ›¸ãã•ã‚ŒãŸå ´åˆã§ã‚‚ã€å¤‰æ›´ã—ãŸBãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã—ã¦è¨˜éŒ²ã•ã‚Œã‚‹ã®ã§ã€æ•°å€¤ã«èª¤å·®ãŒå‡ºã¾ã™ã€‚*

ã¾ãŸSPAã¯èª­ã¿è¾¼ã¿ãŒç™ºç”Ÿã—ãªã„ã®ã§ã€ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®ã¾ã¾ãƒ†ã‚¹ãƒˆã‚’è¡Œã†ã¨ã€*ãƒšãƒ¼ã‚¸é·ç§»ã—ãŸéš›ãƒ†ã‚¹ãƒˆçµæœãŒåæ˜ ã•ã‚Œã¾ã›ã‚“ã€‚*  
ãã‚Œã§ã¯å›°ã‚‹ã®ã§ã€æœ‰åŠ¹åŒ–ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’[ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«å¾Œ](https://support.google.com/optimize/answer/7008840?hl=ja)ã«è¨­å®šã—ã¾ã™ã€‚

### ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ™ãƒ³ãƒˆã‚’åŸ‹ã‚è¾¼ã‚€

```javascript
dataLayer.push({'event': 'optimize.activate'});
```

ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã‚’ã€ãƒ†ã‚¹ãƒˆã‚’è¡Œã„ãŸã„ãƒšãƒ¼ã‚¸ã«åŸ‹ã‚è¾¼ã¿ã¾ã™ã€‚

```javascript
import React, { useEffect } from "react";

const IndexPage = ({ location }) => {
   useEffect(() => {
     window.dataLayer = window.dataLayer || [];
     window.dataLayer.push({'event': 'optimize.activate'});
   }, [location.pathname])
   return (
     <div>...</div>
   )
}
export default IndexPage;
```

### Google Optimizeå´ã®è¨­å®š
ã‚¨ã‚¯ã‚¹ãƒšãƒªã‚¨ãƒ³ã‚¹ã‚’ä½œæˆã—ãŸã‚‰ã€ãƒ†ã‚¹ãƒˆã®æœ‰åŠ¹åŒ–ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’```optimize.active```ã«ã—ã¾ã™ã€‚

![](/images/blog/2020.07.28_01-02.jpg)

---

## ãƒ‡ãƒãƒƒã‚¯ã™ã‚‹

ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¿½åŠ ã—ãŸã‚‰ã€æ­£å¸¸ã«å‹•ä½œã™ã‚‹ã‹ãƒ‡ãƒãƒƒã‚¯ã—ã¾ã™ã€‚

![](/images/blog/2020.07.28_01-03.jpg)

ã‚¨ãƒ©ãƒ¼ãŒå‡ºãªã‘ã‚Œã°å®Œäº†ã§ã™ğŸ˜Š

![](/images/blog/2020.07.28_01-04.jpg)
